<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Logitech Z407 Remote Control</title>

    <meta name="theme-color" content="#121212">

    <!-- Favicon (Emoji SVG) -->
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéõÔ∏è</text></svg>">

    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --primary-color: #bb86fc;
            --secondary-color: #03dac6;
            --danger-color: #cf6679;
            --success-color: #00e676;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            /* justify-content: center; REMOVED to prevent cutting off content */
            min-height: 100vh;
            /* Allow scroll */
            margin: 0;
            padding-top: 20px;
            /* Small top margin */
            padding-bottom: 20px;
            user-select: none;
            box-sizing: border-box;
        }

        .container {
            background-color: var(--card-bg);
            padding: 1.5rem;
            /* Reduced padding for mobile */
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            text-align: center;
            width: 90%;
            max-width: 400px;
            margin-bottom: 20px;
            /* Ensure space at bottom */
        }

        h1 {
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 15px;
            margin-bottom: 20px;
            font-size: 1.5rem;
            /* Slightly smaller for mobile title fit */
        }

        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .btn {
            background-color: #333;
            color: white;
            border: none;
            padding: 20px;
            font-size: 1.5rem;
            border-radius: 15px;
            cursor: pointer;
            transition: transform 0.1s, background-color 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: #000;
        }

        .btn-full {
            grid-column: span 2;
        }

        .status {
            margin-top: 20px;
            font-size: 0.9rem;
            color: #888;
        }

        /* Icons */
        .icon {
            font-size: 1.8rem;
        }

        /* Material Play Button */
        .btn-main-play {
            background-color: #B39DDB;
            /* Pastel Purple */
            color: #311B92;
            /* Deep Purple Text for contrast */
            border: none;
            padding: 25px;
            font-size: 1.2rem;
            font-weight: 600;
            border-radius: 16px;
            /* Material Rounded Corners */
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
            /* Remove blue highlight on tap on mobile */
            -webkit-tap-highlight-color: transparent;
        }

        .btn-main-play:active {
            transform: scale(0.96);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            background-color: #9575CD;
            /* Slightly darker on press */
        }

        .btn-main-play .icon {
            margin-right: 15px;
            transition: transform 0.2s;
        }

        .btn-main-play:active .icon {
            transform: scale(0.8);
        }

        /* Help Buttons */
        .btn-help {
            background: rgba(255, 255, 255, 0.08);
            color: #aaa;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 12px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            transition: all 0.2s;
        }

        .btn-help:hover {
            background: rgba(255, 255, 255, 0.15);
            color: #fff;
        }

        .help-content {
            background: #252525;
            padding: 15px;
            border-radius: 10px;
            text-align: left;
            font-size: 0.85rem;
            color: #ccc;
            border: 1px solid #444;
            animation: fadeIn 0.3s ease;
        }

        .code-block {
            background: #111;
            padding: 8px;
            color: #0f0;
            display: block;
            margin: 8px 0;
            border-radius: 6px;
            font-family: 'Consolas', monospace;
            border: 1px solid #333;
            word-break: break-all;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body>

    <div class="container">
        <h1>Logitech Z407 Remote Control</h1>



        <div class="status-indicator" style="display: flex; align-items: center; justify-content: center; gap: 8px;">
            <span>Status: <span id="connectionStatus" style="color: #888;">Disconnected</span></span>
            <button onclick="window.location.reload()"
                style="background: none; border: none; cursor: pointer; color: #666; font-size: 0.9rem; padding: 2px; transition: transform 0.2s;"
                title="Refresh App" onmouseover="this.style.transform='rotate(180deg)'"
                onmouseout="this.style.transform='rotate(0deg)'">üîÑ</button>
        </div>

        <!-- Status Feedback Message (Moved to top) -->
        <div class="status" id="statusText"
            style="margin-top: 5px; margin-bottom: 15px; font-size: 0.9rem; min-height: 1.2em; color: var(--secondary-color);">
            Ready to connect
        </div>

        <div
            style="background: #333; height: 10px; width: 100%; border-radius: 5px; margin: 20px 0; position: relative; overflow: hidden;">
            <div id="volBar"
                style="background: var(--primary-color); height: 100%; width: 50%; transition: width 0.3s;"></div>
        </div>
        <div style="font-size: 0.8rem; margin-bottom: 20px;">Volume (Estimated): <span id="volText">50%</span></div>

        <!-- Primary Speaker Control -->
        <div class="controls" style="grid-template-columns: 1fr;">
            <button class="btn-main-play" onclick="sendCommand('play_pause')">
                <span class="icon">‚èØ</span> Speaker Play / Pause
            </button>
        </div>

        <div class="controls">
            <button class="btn" onclick="sendCommand('vol_down')">
                <span class="icon">‚ûñ</span>
            </button>
            <button class="btn" onclick="sendCommand('vol_up')">
                <span class="icon">‚ûï</span>
            </button>
        </div>

        <!-- PC Keyboard Simulation Controls -->
        <div style="margin: 20px 0; background: #252525; padding: 15px; border-radius: 15px; border: 1px dashed #444;">
            <p
                style="margin: 0 0 10px 0; font-size: 0.8rem; color: #aaa; text-transform: uppercase; letter-spacing: 1px;">
                PC Media Control (xdotool)</p>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                <button class="btn" style="background: #333; padding: 15px;" onclick="sendCommand('prev')">
                    <span class="icon">‚èÆ</span>
                </button>
                <button class="btn" style="background: #333; padding: 15px;" onclick="sendCommand('play_pause_pc')">
                    <span class="icon">‚èØ</span>
                </button>
                <button class="btn" style="background: #333; padding: 15px;" onclick="sendCommand('next')">
                    <span class="icon">‚è≠</span>
                </button>
            </div>
            <!-- PC Volume Row -->
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 10px;">
                <button class="btn" style="background: #333; padding: 15px;" onclick="sendCommand('vol_down_pc')">
                    <span class="icon">üîâ</span>
                </button>
                <button class="btn" style="background: #333; padding: 15px;" onclick="sendCommand('mute_pc')">
                    <span class="icon">üîá</span>
                </button>
                <button class="btn" style="background: #333; padding: 15px;" onclick="sendCommand('vol_up_pc')">
                    <span class="icon">üîä</span>
                </button>
            </div>
        </div>
        <div class="controls">
            <button class="btn" onclick="sendCommand('input_aux')">AUX (Jack)</button>
            <button class="btn" onclick="sendCommand('input_bluetooth')">BT</button>
        </div>

        <div style="margin-top: 30px; border-top: 1px solid #333; padding-top: 20px;">
            <p style="font-size: 0.8rem; color: #666; margin-bottom: 10px;">ADVANCED</p>
            <div class="controls" style="grid-template-columns: 1fr 1fr;">
                <button class="btn" style="background-color: #2c2c2c; font-size: 1rem;"
                    onclick="confirmAction('bluetooth_pair', 'Activate pairing?')">
                    üì° Pair
                </button>
                <button class="btn" style="background-color: #3f2222; font-size: 1rem; color: #ff6b6b;"
                    onclick="confirmAction('factory_reset', 'FACTORY RESET? This will erase your devices.')">
                    ‚ö†Ô∏è Reset
                </button>
            </div>
        </div>
    </div>

    <!-- Help Section -->
    <div style="margin-top: 40px; display: flex; flex-direction: column; gap: 15px;">

        <!-- Windows Help -->
        <button id="helpBtnWin" onclick="toggleHelp()" class="btn-help">
            <span id="helpIconWin" style="margin-right: 8px;">üíª</span>
            <span id="helpTextWin">Windows Help</span>
        </button>
        <div id="winHelp" class="help-content" style="display: none;">
            <p><strong>1. Bluetooth Won't connect?</strong><br>
                Ensure your PC Bluetooth is ON and speakers are already paired in Windows Settings.</p>
            <p><strong>2. PC Buttons not working?</strong><br>
                The console window must NOT be in "Select Mode" (if you clicked inside the black window, press ENTER to
                release it).</p>
            <p><strong>3. Mobile site not loading?</strong><br>
                Check <strong>Windows Firewall</strong> or your <strong>VPN</strong>. Ensure the app is allowed on your
                network, or try temporarily
                disabling the firewall/VPN. Also check that your network profile is set to "Private" (Home), not
                "Public".
            </p>
            <p><strong>4. Wrong IP Address?</strong><br>
                If the displayed IP doesn't work, you might be using a VPN or VM. Run <code>ipconfig</code> in your
                terminal (CMD) to
                find your real Wi-Fi IP adapter.</p>
            <p><strong>5. Error "Unreachable"?</strong><br>
                The Z407 speakers only accept <strong>ONE</strong> active BLE controller at a time. If your phone
                connects to them automatically via Bluetooth, disconnect it so the PC can take control.</p>
        </div>


    </div>

    <!-- Donation Footer -->
    <div <div
        style="margin-top: 40px; border-top: 1px solid #333; padding: 20px 10px; color: #888; font-size: 0.8rem; line-height: 1.6;">
        <p>This project is 100% free.</p>
        <p>Any donation (no matter how small) helps me dedicate more time and resources to this and other projects.
            Infinite thanks to those who have already collaborated! ‚ù§Ô∏è</p>
        <p><a href="https://androrama.com" target="_blank"
                style="color: var(--secondary-color); text-decoration: none; font-weight: bold;">‚Üí
                https://androrama.com</a></p>
        <p style="margin-top: 15px;">And to those who haven't, thank you for using the project even if you don't donate,
            that already makes me very happy üòä</p>

        <!-- Original Research Credit -->
        <p style="font-size: 0.7rem; color: #555; margin-top: 25px; border-top: 1px solid #222; padding-top: 10px;">
            Special thanks to <a href="https://github.com/freundTech/logi-z407-reverse-engineering" target="_blank"
                style="color: #666; text-decoration: none;">freundTech</a> for the reverse engineering work.
        </p>
        <p style="font-size: 0.7rem; color: #555;">
            (Linux/Raspberry Pi version also available)
        </p>
        <p style="font-size: 0.6rem; color: #444; margin-top: 5px;">
            Disclaimer: This is an unofficial app. Not affiliated with or endorsed by Logitech. Use this software at
            your own risk.
        </p>
    </div>
    </div>

    <script>
        const statusText = document.getElementById('statusText');
        const connectionStatus = document.getElementById('connectionStatus');
        const volBar = document.getElementById('volBar');
        const volText = document.getElementById('volText');

        function sendCommand(command) {
            fetch(`/api/${command}`, { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        statusText.innerText = "Command sent: " + command;
                        statusText.style.color = "var(--success-color)";
                        setTimeout(updateStatus, 500);
                    } else {
                        statusText.innerText = "Error: " + data.error;
                        statusText.style.color = "var(--danger-color)";
                        if (data.error.includes("xdotool")) {
                            alert(data.error);
                        }
                    }
                })
                .catch(err => {
                    statusText.innerText = "Network Error";
                    statusText.style.color = "var(--danger-color)";
                });
        }

        function confirmAction(cmd, text) {
            if (confirm(text)) {
                sendCommand(cmd);
            }
        }

        function updateStatus() {
            fetch('/api/status')
                .then(response => response.json())
                .then(data => {
                    if (data.connected) {
                        connectionStatus.innerText = "Connected ‚úÖ";
                        connectionStatus.style.color = "var(--success-color)";
                    } else {
                        connectionStatus.innerText = "Disconnected ‚ùå";
                        connectionStatus.style.color = "var(--danger-color)";
                    }

                    if (data.volume !== undefined) {
                        volBar.style.width = data.volume + "%";
                        volText.innerText = data.volume + "%";
                    }
                })
                .catch(console.error);
        }

        // Poll status every 5 seconds
        setInterval(updateStatus, 5000);
        updateStatus();

        function toggleHelp() {
            const helpDiv = document.getElementById('winHelp');
            const icon = document.getElementById('helpIconWin');
            const text = document.getElementById('helpTextWin');
            const defaultText = "Windows Help";
            const defaultIcon = "üíª";

            if (helpDiv.style.display === 'none') {
                helpDiv.style.display = 'block';
                icon.innerText = "üîº";
                text.innerText = "Hide " + defaultText;
                setTimeout(() => helpDiv.scrollIntoView({ behavior: 'smooth', block: 'start' }), 100);
            } else {
                helpDiv.style.display = 'none';
                icon.innerText = defaultIcon;
                text.innerText = defaultText;
            }
        }


    </script>
</body>

</html>
```